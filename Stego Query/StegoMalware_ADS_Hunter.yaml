SELECT 
    ads.path AS FilePath,
    ads.stream_name AS ADSName,
    ads.size AS ADSSize,
    entropy.value AS Entropy,
    string.hex AS HexPreview,
    CASE 
        WHEN string.hex LIKE '4D5A%' THEN "PE"
        WHEN string.hex LIKE '504B%' THEN "ZIP"
        WHEN string.hex LIKE 'FFD8%' THEN "JPG"
        WHEN string.hex LIKE '89504E%' THEN "PNG"
        ELSE "Unknown"
    END AS MagicType,
    CASE 
        WHEN entropy.value > 7.5 THEN "High"
        WHEN entropy.value > 6.5 THEN "Moderate"
        ELSE "Low"
    END AS EntropyLevel
FROM glob(globs=['C:\\Users\\*\\Desktop\\*','C:\\Users\\*\\Downloads\\*','C:\\Users\\*\\Documents\\*','C:\\ProgramData\\*']) AS file
JOIN NTFS.EnumerateADS(filename=file.path) AS ads
JOIN read_file(filename=ads.path + ":" + ads.stream_name, length=512) AS content
JOIN hash(content=content.data, algorithm="entropy") AS entropy
JOIN string_hex(string=content.data, length=8) AS string
WHERE ads.stream_name != "$DATA"
